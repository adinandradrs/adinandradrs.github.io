<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Efisiensi Query Join ke Object tanpa ORM" /><meta name="author" content="Adinandra Dharmasurya" /><meta property="og:locale" content="en" /><meta name="description" content="Beberapa hari yang lalu saya membaca artikel yang dishare pada group Telegram JVM Indonesia, topiknya menarik perhatian saya karena membahas tentang perbandingan performance (benchmark) antar database driver untuk framework per masing-masing bahasa pemrograman. Silakan dibaca terlebih dahulu artikel tersebut dan setelah membaca artikel tersebut saya tidak akan membahas serta memprovokasi agar melirik bahasa pemrogramannya. Saya sendiri lebih tertarik untuk menelisik di bagian Spring Data JDBC yang memiliki performance sangat optimal." /><meta property="og:description" content="Beberapa hari yang lalu saya membaca artikel yang dishare pada group Telegram JVM Indonesia, topiknya menarik perhatian saya karena membahas tentang perbandingan performance (benchmark) antar database driver untuk framework per masing-masing bahasa pemrograman. Silakan dibaca terlebih dahulu artikel tersebut dan setelah membaca artikel tersebut saya tidak akan membahas serta memprovokasi agar melirik bahasa pemrogramannya. Saya sendiri lebih tertarik untuk menelisik di bagian Spring Data JDBC yang memiliki performance sangat optimal." /><link rel="canonical" href="https://adinandra.dharmasurya.id/posts/efisiensi-query-join-ke-object-tanpa-orm/" /><meta property="og:url" content="https://adinandra.dharmasurya.id/posts/efisiensi-query-join-ke-object-tanpa-orm/" /><meta property="og:site_name" content="Adinandra Dharmasurya" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-02-13T00:00:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Efisiensi Query Join ke Object tanpa ORM" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Adinandra Dharmasurya"},"dateModified":"2022-02-13T00:00:00+00:00","datePublished":"2022-02-13T00:00:00+00:00","description":"Beberapa hari yang lalu saya membaca artikel yang dishare pada group Telegram JVM Indonesia, topiknya menarik perhatian saya karena membahas tentang perbandingan performance (benchmark) antar database driver untuk framework per masing-masing bahasa pemrograman. Silakan dibaca terlebih dahulu artikel tersebut dan setelah membaca artikel tersebut saya tidak akan membahas serta memprovokasi agar melirik bahasa pemrogramannya. Saya sendiri lebih tertarik untuk menelisik di bagian Spring Data JDBC yang memiliki performance sangat optimal.","headline":"Efisiensi Query Join ke Object tanpa ORM","mainEntityOfPage":{"@type":"WebPage","@id":"https://adinandra.dharmasurya.id/posts/efisiensi-query-join-ke-object-tanpa-orm/"},"url":"https://adinandra.dharmasurya.id/posts/efisiensi-query-join-ke-object-tanpa-orm/"}</script><title>Efisiensi Query Join ke Object tanpa ORM | Adinandra Dharmasurya</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Adinandra Dharmasurya"><meta name="application-name" content="Adinandra Dharmasurya"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-right"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /etc/avatar.jpeg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Adinandra Dharmasurya</a></div><div class="site-subtitle">Just Another Personal Weblog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/adinandradrs" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="http://instagram.com/adinandradrs" aria-label="instagram" target="_blank" rel="noopener"> <i class="fab fa-instagram"></i> </a> <a href="https://www.linkedin.com/in/adinandra-dharmasurya/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Efisiensi Query Join ke Object tanpa ORM</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 350 350'%3E%3C/svg%3E" data-src="/etc/scripting.png" class="preview-img bg" alt="Scripting" width="350" height="350" data-proofer-ignore><h1 data-toc-skip>Efisiensi Query Join ke Object tanpa ORM</h1><div class="post-meta text-muted"><div> By <em> Adinandra Dharmasurya </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1644710400" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-02-13 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1429 words"> <em>7 min</em> read</span></div></div></div><div class="post-content"><p>Beberapa hari yang lalu saya membaca <a href="https://www.travisluong.com/fastapi-vs-fastify-vs-spring-boot-vs-gin-benchmark/">artikel</a> yang dishare pada group Telegram JVM Indonesia, topiknya menarik perhatian saya karena membahas tentang perbandingan performance (benchmark) antar database driver untuk framework per masing-masing bahasa pemrograman. Silakan dibaca terlebih dahulu artikel tersebut dan setelah membaca artikel tersebut saya tidak akan membahas serta memprovokasi agar melirik bahasa pemrogramannya. Saya sendiri lebih tertarik untuk menelisik di bagian Spring Data JDBC yang memiliki performance sangat optimal.</p><p>Menjadi pertanyaan buat beberapa orang kenapa harus menggunakan Spring Data JDBC agar performa menjadi lebih optimal dibandingkan dengan menggunakan Spring Data JPA. Pertanyaan tersebut terjawab pada artikel dari Baeldung berikut <a href="https://www.baeldung.com/spring-data-jdbc-intro">ini</a>, silakan cermati di bagian conclusion. Nah berhubung saya adalah seorang polyglot yang sering menggunakan ORM (Object Relational Mapping) agar lebih merdeka dari implementasi database dan lebih fokus pada bisnis serta kode tentunya merasakan kepedihan jika harus menggunakan native driver.</p><p>Kenapa saya lebih suka ORM? Tentunya dikarenakan tidak harus terlalu banyak berurusan dengan implementasi database. Relasi dapat langsung terikat di dalam kode (e.g di Spring Data kita dapat mendefinisikan kardinalitas relasi antar class dengan anotasi), what you type is what you get. Kebetulan saya adalah tipikal engineer yang sangat memperhatikan memory footprint pada hasil eksekusi proses. Jika saya rasa hasil transaksi atau query kurang optimal dengan ORM pun saya masih bisa melakukan tuning tipe fetch, native query, dan dengan custom <a href="https://www.baeldung.com/spring-data-jpa-projections">projection</a> di level repository.</p><p>Namun tetap ada trade off dari penggunaan ORM di mana saya tidak dapat mengkontrol semua perintah query e.g query fetch (entah itu akan menjadi subset query atau join) yang dieksekusi oleh ORM (kalau pun bisa mentok biasanya saya main di tipenya, justru akan menjadi pertanyaan kenapa saya menggunakan ORM tetapi masih harus ribet mengatur semua query pada elemen fetch). Spike dengan ORM (berlaku bagi engineer yang tidak bijak) juga akan sangat terasa ketika mengalami high throughputs dan ujung-ujungnya mengakibatkan performance issue tentunya. Dan jika kita sudah baca artikel di atas tentunya akan mulai mempertimbangkan penggunaan native driver di beberapa aspek bisnis misalnya yang dinilai kritikal dan menjadi tolok ukur bagi pelanggan serta atasan kita 😀</p><p>Di ORM semua table adalah class dan kolom-kolomnya adalah attributenya sehingga kita tidak perlu memusingkan perihal mapping kembali dari query ke object yang kita inginkan. Termasuk juga relasinya semua sudah diotomatiskan ke tipe relasinya pada object. Untuk kasus tanpa ORM maka ada beberapa pendekatan yang dapat kita lakukan (dari yang terburuk hingga yang tampaknya aman, I’m not sure though but worth to try). Casenya semisal kita memiliki 2 tabel beserta model entity dengan kardinalitas 1..n yaitu Posts dan Comments, kita ingin mendapatkan detail post beserta komentar-komentarnya berdasarkan id.</p><p>Relasi pada tabel-tabel berikut ini adalah 1 artikel dapat memiliki beberapa komentar dan sebaliknya 1 komentar berelasi dengan 1 artikel.</p><p><strong>Tabel Posts</strong></p><div class="table-wrapper"><table><thead><tr><th>id<th>post_title<th>content<th>created_date<th>created_by<tbody><tr><td>1<td>Lorem Ipsum<td>…<td>…<td>…</table></div><p><strong>Table Comments</strong></p><div class="table-wrapper"><table><thead><tr><th>id<th>post_id<th>message<th>created_date<th>created_by<tbody><tr><td>1<td>1<td>Nice article but ….<td>…<td>…<tr><td>2<td>1<td>I think the article can be ….<td>…<td>…<tr><td>3<td>1<td>Whoa, what a great ….<td>…<td>…</table></div><p><strong>Entity Post</strong></p><p>Entity Post merupakan pseudo yang dapat merepresentasikan tabel Posts beserta relasi 1..n ke tabel Comments pada attribute comments, entity dapat diumpamakan sebagai class atau struct.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>entity Post {
	id long
	postTitle string
	content text
	createdDate timestamp
	createdBy long
	comments CollectionOf(comment)
}
</pre></table></code></div></div><p><strong>Entity Comment</strong></p><p>Entity Comment merupakan pseudo yang dapat merepresentasikan tabel Comment beserta relasi 1..1 ke tabel Posts pada attribute post, entity berikut dapat diumpamakan sebagai class atau struct.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>entity Comment {
	id long
	post Post
	message text
	createdDate timestamp
	createdBy long
}
</pre></table></code></div></div><p>Tanpa menggunakan ORM maka diperlukan sedikit usaha agar dapat merelasikan antara attribute comments pada entity Post dan attribute post pada entity Comment. Pendekatan yang dapat kita lakukan semisal ingin melakukan query data dari table posts untuk ditarik detail post beserta komentarnya agar menjadi collection di attribute comments adalah dengan :</p><h2 id="subquery"><span class="mr-2">Subquery</span><a href="#subquery" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Select terlebih dahulu tabel Post. Scan row dan mapping kolom ke attribute pada entity Post seperti id, postTitle, content, createdDate, dan createdBy.</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">posts</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span> <span class="o">?</span><span class="mi">1</span>
</pre></table></code></div></div><p>Setelah mendapatkan table Posts maka tahap berikutnya query ke table Comments berdasarkan foreign key yaitu post_id.</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">comments</span> <span class="k">where</span> <span class="n">post_id</span> <span class="o">=</span> <span class="o">?</span><span class="mi">1</span>
</pre></table></code></div></div><p>Stream rows dan scan setiap row untuk mapping kolom ke entity Comment. Setiap row mapping ke entity Comment akan dimasukkan ke dalam sebuah collection pada attribute comments di entity Post.</p><h2 id="join-dan-proses-berdasarkan-normalisasi-dari-hasil-query"><span class="mr-2">Join dan Proses Berdasarkan Normalisasi dari Hasil Query</span><a href="#join-dan-proses-berdasarkan-normalisasi-dari-hasil-query" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Pada pendekatan berikut hanya dibutuhkan sekali query. Select dengan melakukan join tabel Posts dengan tabel Comments, kira-kira gambaran joinnya seperti berikut.</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="k">select</span>
    <span class="n">p</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">post_title</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">content</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">created_by</span><span class="p">,</span> 
    <span class="n">p</span><span class="p">.</span><span class="n">created_date</span><span class="p">,</span> <span class="k">c</span><span class="p">.</span><span class="n">id</span> <span class="k">as</span> <span class="n">comment_id</span><span class="p">,</span> <span class="k">c</span><span class="p">.</span><span class="n">message</span> <span class="n">message</span><span class="p">,</span> 
    <span class="k">c</span><span class="p">.</span><span class="n">created_by</span> <span class="k">as</span> <span class="n">comment_by</span><span class="p">,</span> <span class="k">c</span><span class="p">.</span><span class="n">created_date</span> <span class="k">as</span> <span class="n">comment_date</span> 
<span class="k">from</span> <span class="n">posts</span> <span class="n">p</span> <span class="k">inner</span> <span class="k">join</span>
<span class="n">comments</span> <span class="k">c</span> <span class="k">on</span> <span class="n">p</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="k">c</span><span class="p">.</span><span class="n">post_id</span> <span class="k">where</span> <span class="k">c</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="o">?</span><span class="mi">1</span>
</pre></table></code></div></div><p>Maka akan menghasilkan set data dari query di atas dengan normalisasi seperti pada tabel bawah ini.</p><div class="table-wrapper"><table><thead><tr><th>id<th>post_title<th>content<th>created_by<th>created_date<th>comment_id<th>message<th>comment_by<th>comment_date<th> <tbody><tr><td>1<td>Lorem Ipsum<td>….<td>….<td>….<td>1<td>Nice article but<td>….<td>….<td>….<tr><td>1<td>Lorem Ipsum<td>….<td>….<td>….<td>2<td>I think the article can be<td>….<td>….<td>….</table></div><p>Lalu untuk melakukan mapping dapat dilakukan 2 kali proses yaitu :</p><ul><li>Row dengan indeks pertama untuk kolom id sampai dengan created_date dapat dimapping sebagai data untuk entity Post.<li>Sedangkan kolom comment_id sampai dengan comment_date pada indeks pertama dan berikutnya dapat dilakukan stream dan dimapping menjadi collection data untuk attribute comments.</ul><h2 id="join-dan-construct-hasil-query-dengan-berupa-dokumen-json"><span class="mr-2">Join dan construct hasil query dengan berupa dokumen (JSON)</span><a href="#join-dan-construct-hasil-query-dengan-berupa-dokumen-json" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>RDBMS jaman now sekarang sudah semakin canggih, sehingga kita dapat melakukan hasil query dengan output dokumen JSON seperti database yang berorientasi dokumen e.g MongoDB. Ekspektasi data yang dapat kita bayangkan adalah berupa seperti berikut (disesuaikan dengan entity Post dan tabel Posts).</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre>{
	id : 1,
	post_title : "Lorem Ipsum",
	content : "....",
	created_date : "....",
	created_by : "....",
	comments : [
		{
			id : 1,
			message : "Nice article but ....",
			created_date : "....",
			created_by : "....",
			post_id : 1
		},
		{
			id : 2,
			message : "I think the article can be ....",
			created_date : "....",
			created_by : "....",
			post_id : 1
		}
	]
}
</pre></table></code></div></div><p>Lalu bagaimana cara melakukan query agar dapat menghasilkan data seperti di atas? Saya akan memberikan contoh dengan menggunakan database Postgres. Untuk database dengan produk lain dapat menyesuaikan, setahu saya Oracle dan SQL Server pun juga mempunyai fungsi yang serupa. Perlu dicatat pendekatan yang saya lakukan berikut ini tidak serta merta menjadi satu dokumen namun saya pecah ke beberapa kolom namun hanya dalam sekali eksekusi query.</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">SELECT</span>
    <span class="n">row_to_json</span><span class="p">(</span><span class="n">P</span><span class="p">.</span><span class="o">*</span><span class="p">)</span> <span class="n">post</span><span class="p">,</span>
    <span class="n">array_to_json</span><span class="p">(</span><span class="n">array_agg</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="k">C</span><span class="p">.</span><span class="o">*</span><span class="p">))</span> <span class="n">comments</span><span class="p">,</span>
<span class="k">FROM</span> <span class="n">POSTS</span> <span class="n">P</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">COMMENTS</span> <span class="k">C</span> <span class="k">ON</span> <span class="k">C</span><span class="p">.</span><span class="n">POST_ID</span> <span class="o">=</span> <span class="n">P</span><span class="p">.</span><span class="n">ID</span>
<span class="k">WHERE</span> <span class="n">P</span><span class="p">.</span><span class="n">ID</span> <span class="o">=</span> <span class="o">?</span><span class="mi">1</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">P</span><span class="p">.</span><span class="n">ID</span>
</pre></table></code></div></div><p>Query di atas sekiranya ketika dieksekusi akan menghasilkan data set sebagai berikut. Untuk melakukan mapping menjadi lebih mudah dengan serialisasi JSON string ke data type pada entity. Kolom post diserialize menjadi entitas Post untuk attribute id sampai dengan createdDate, sedangan kolom comments menjadi diserialize menjadi attribute comments pada entitas Post.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre>COLUMN POST
---------------
{
	id : 1,
	post_title : "Lorem Ipsum",
	content : "….",
	created_date : "….",
	created_by : "…."
}

COLUMN COMMENTS
---------------
[
	{
		id : 1,
		message : "Nice article but ….",
		created_date : "….",
		created_by : "….",
		post_id : 1
	},
	{
		id : 2,
		message : "I think the article can be ….",
		created_date : "….",
		created_by : "….",
		post_id : 1
	}
]
</pre></table></code></div></div><p>Berikut adalah hasil eksekusinya (by the way, saya menggunakan bahasa pemrograman Go dengan driver PGX) :</p><ol><li>Pendekatan 1, execution time 5ms<li>Pendekatan 2, execution time 3.124 ms<li>Pendekatan 3, execution time 870µs</ol><p>Dari beberapa pendekatan di atas saya menarik kesimpulan dari test eksekusi beserta memory footprintnya memiliki hasil optimal dengan pendekatan nomor 3 karena hanya sekali eksekusi dan proses stream collection untuk menjadi sebuah entity. Sedangkan nomor 2 juga masih cukup cepat namun agak boros di bagian proses untuk menjadi sebuah entity. Pendekatan nomor 1 dirasa tidak saya rekomendasikan karena semakin banyak roundtrip eksekusi query akan membuat boros koneksi ataupun peminjaman pool koneksi dan dampaknya waktu respon akan lebih lama.</p><p>Hasil testing ini bernilai relatif tergantung casenya. Namun sekiranya postingan ini juga dapat menjadi referensi atau ide bagi rekan-rekan yang mungkin bingung bagaimana cara serta pendekatan mapping query join ke object tanpa ORM. Terimakasih.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/pemrograman/'>Pemrograman</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/sql/" class="post-tag no-text-decoration" >sql</a> <a href="/tags/go/" class="post-tag no-text-decoration" >go</a> <a href="/tags/performance/" class="post-tag no-text-decoration" >performance</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Efisiensi+Query+Join+ke+Object+tanpa+ORM+-+Adinandra+Dharmasurya&url=https%3A%2F%2Fadinandra.dharmasurya.id%2Fposts%2Fefisiensi-query-join-ke-object-tanpa-orm%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Efisiensi+Query+Join+ke+Object+tanpa+ORM+-+Adinandra+Dharmasurya&u=https%3A%2F%2Fadinandra.dharmasurya.id%2Fposts%2Fefisiensi-query-join-ke-object-tanpa-orm%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fadinandra.dharmasurya.id%2Fposts%2Fefisiensi-query-join-ke-object-tanpa-orm%2F&text=Efisiensi+Query+Join+ke+Object+tanpa+ORM+-+Adinandra+Dharmasurya" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/tahun-baru-di-malaysia/">Tahun Baru di Malaysia</a><li><a href="/posts/go-starter-dengan-gin-framework/">Go Starter dengan Gin Framework</a><li><a href="/posts/terimakasih-wordpress-halo-jekyll/">Terimakasih WordPress, Halo Jekyll</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/travelling/">travelling</a> <a class="post-tag" href="/tags/indonesia/">indonesia</a> <a class="post-tag" href="/tags/hiking/">hiking</a> <a class="post-tag" href="/tags/retro/">retro</a> <a class="post-tag" href="/tags/custom/">custom</a> <a class="post-tag" href="/tags/salatiga/">salatiga</a> <a class="post-tag" href="/tags/touring/">touring</a> <a class="post-tag" href="/tags/tourism/">tourism</a> <a class="post-tag" href="/tags/arsys/">arsys</a> <a class="post-tag" href="/tags/automationscript/">automationscript</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/koneksi-database-dengan-asp-classic/"><div class="card-body"> <em class="timeago small" data-ts="1393718400" > 2014-03-02 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Koneksi Database dengan ASP Classic</h3><div class="text-muted small"><p> ASP Classic merupakan scripting yang cukup menjadi pada trend tahun 1998 - 2000an. Aplikasi dan pengembangnya sudah langka untuk ditemukan di era sekarang. Bahasanya cukup unik yaitu VBS dan JScrip...</p></div></div></a></div><div class="card"> <a href="/posts/eksekusi-store-procedure-dengan-java/"><div class="card-body"> <em class="timeago small" data-ts="1437782400" > 2015-07-25 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Eksekusi Store Procedure dengan Java</h3><div class="text-muted small"><p> Berhubung minggu malam ini sedang hujan deras dan tidak dapat keluar dari kost, akhirnya saya iseng membuka IDE Eclipse yang lama tidak tersentuh. Tema coding pada tulisan ini adalah eksekusi store...</p></div></div></a></div><div class="card"> <a href="/posts/go-starter-dengan-gin-framework/"><div class="card-body"> <em class="timeago small" data-ts="1643500800" > 2022-01-30 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Go Starter dengan Gin Framework</h3><div class="text-muted small"><p> Tentunya bagi seorang pengembang yang akan mengawali project software engineering akan jauh lebih mudah ketika sudah ada base project yang menjadi acuan. Base project dapat dikatakan sebagai starte...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/go-starter-dengan-gin-framework/" class="btn btn-outline-primary" prompt="Older"><p>Go Starter dengan Gin Framework</p></a> <a href="/posts/wayang-kulit/" class="btn btn-outline-primary" prompt="Newer"><p>Wayang Kulit</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://adinandra.dharmasurya.id/posts/efisiensi-query-join-ke-object-tanpa-orm/'; this.page.identifier = '/posts/efisiensi-query-join-ke-object-tanpa-orm/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://adinandra-dharmasurya-id.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://adinandra.dharmasurya.id">Adinandra Dharmasurya</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Illustrations are taken from Storyset. Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> - mod theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/travelling/">travelling</a> <a class="post-tag" href="/tags/indonesia/">indonesia</a> <a class="post-tag" href="/tags/hiking/">hiking</a> <a class="post-tag" href="/tags/retro/">retro</a> <a class="post-tag" href="/tags/custom/">custom</a> <a class="post-tag" href="/tags/salatiga/">salatiga</a> <a class="post-tag" href="/tags/touring/">touring</a> <a class="post-tag" href="/tags/tourism/">tourism</a> <a class="post-tag" href="/tags/arsys/">arsys</a> <a class="post-tag" href="/tags/automationscript/">automationscript</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-Y318KQQK47"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-Y318KQQK47'); }); </script>
